# Implementation Plan: Full-Stack Web Todo Application with Authentication

**Branch**: `002-web-todo-app` | **Date**: 2025-12-21 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-web-todo-app/spec.md`

## Summary

Build a full-stack web-based todo application with user authentication, enabling users to securely manage their personal task lists from any browser. The application uses Next.js 16+ for the frontend with Better Auth for authentication, FastAPI for the backend API, and Neon Serverless PostgreSQL for persistent storage. All code will be generated by Claude Code following Spec-Driven Development methodology, with no manual coding permitted.

## Technical Context

**Language/Version**:
- Frontend: TypeScript with Next.js 16+ (App Router), Node.js 18+
- Backend: Python 3.10+

**Primary Dependencies**:
- Frontend: Next.js 16+, React 18+, Better Auth, Tailwind CSS, TypeScript
- Backend: FastAPI, SQLModel, Pydantic, python-jose[cryptography] (JWT), passlib (password hashing), asyncpg (PostgreSQL driver)

**Storage**: Neon Serverless PostgreSQL (cloud-hosted, persistent)

**Testing**: Manual testing per quickstart.md (automated tests optional/Phase III)

**Target Platform**:
- Frontend: Modern web browsers (Chrome, Firefox, Safari, Edge)
- Backend: Linux/macOS server environment

**Project Type**: Web application (frontend + backend monorepo)

**Performance Goals**:
- API response time: <2 seconds under normal load
- Page load time: <2 seconds for dashboard
- Task operations: <3 seconds end-to-end

**Constraints**:
- No manual code writing (all code generated by Claude Code)
- Environment variables for all secrets (no hardcoded credentials)
- User isolation enforced at database level (foreign key + API validation)
- Full-stack separation: Frontend ↔ REST API ↔ Database

**Scale/Scope**:
- Support 10+ concurrent users initially
- 2 entity types (User, Task)
- 7 API endpoints (1 auth group, 1 tasks CRUD group)
- 4 frontend pages (signup, signin, dashboard, protected routes)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Phase II Constitution Compliance

| Principle | Requirement | Status | Notes |
|-----------|-------------|--------|-------|
| **I. Spec-Driven First** | All development starts from written specs | ✅ PASS | spec.md complete with 54 FRs, 5 user stories |
| **II. No Manual Coding** | All code generated by Claude Code | ✅ PASS | Workflow enforces AI generation |
| **III. Phase II Scope Discipline** | Full-stack web app with auth, persistence, REST API | ✅ PASS | Scope limited to 5 core CRUD ops, no AI (Phase III) |
| **IV. Feature Completeness** | All 5 basic todo features before enhancements | ✅ PASS | User stories prioritized P1-MVP → P3 |
| **V. Deterministic Behavior** | Clear UI, proper HTTP codes, error handling | ✅ PASS | FR-038 to FR-053 define UI/API contracts |
| **VI. Clean Architecture** | Frontend (Next.js) ↔ API (FastAPI) ↔ DB (SQLModel) | ✅ PASS | Monorepo with clear separation |
| **VII. Explicit Contracts** | UI and REST API documented | ✅ PASS | Will generate in Phase 1: contracts/ |
| **VIII. Testability by Design** | Logic deterministic, endpoints testable | ✅ PASS | Manual testing via quickstart.md |
| **IX. Spec Evolution Expected** | Iterative refinement allowed | ✅ PASS | Spec is authoritative source |
| **X. Authentication First** | Better Auth + JWT required | ✅ PASS | User Story 1 (P1-MVP), FR-001 to FR-010 |
| **XI. Persistent Storage** | Neon PostgreSQL required | ✅ PASS | FR-034 to FR-037, no in-memory storage |
| **XII. User Isolation** | Database-level + API-level enforcement | ✅ PASS | FR-020, FR-026, FR-030 (403 on violations) |
| **XIII. Full-Stack Separation** | Clear frontend/backend boundaries | ✅ PASS | Monorepo structure, REST API only |

**Gate Status**: ✅ **ALL CHECKS PASSED** - Proceed to Phase 0 Research

**Violations**: None

**Justifications**: N/A

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
backend/                         # FastAPI backend application
├── app/
│   ├── __init__.py
│   ├── main.py                  # FastAPI app entry point
│   ├── config.py                # Environment configuration
│   ├── database.py              # Database connection setup
│   ├── models/                  # SQLModel entities
│   │   ├── __init__.py
│   │   ├── user.py              # User model
│   │   └── task.py              # Task model
│   ├── schemas/                 # Pydantic request/response schemas
│   │   ├── __init__.py
│   │   ├── auth.py              # Auth DTOs
│   │   └── task.py              # Task DTOs
│   ├── services/                # Business logic layer
│   │   ├── __init__.py
│   │   ├── auth_service.py      # Authentication logic
│   │   └── task_service.py      # Task CRUD logic
│   ├── api/                     # API routes
│   │   ├── __init__.py
│   │   ├── auth.py              # Auth endpoints
│   │   └── tasks.py             # Task endpoints
│   └── middleware/              # Middleware components
│       ├── __init__.py
│       └── jwt_middleware.py    # JWT verification
├── requirements.txt             # Python dependencies
└── .env.example                 # Environment template

frontend/                        # Next.js frontend application
├── src/
│   ├── app/                     # Next.js 16+ App Router
│   │   ├── layout.tsx           # Root layout
│   │   ├── page.tsx             # Home/landing page
│   │   ├── signup/
│   │   │   └── page.tsx         # Signup page
│   │   ├── signin/
│   │   │   └── page.tsx         # Signin page
│   │   └── dashboard/
│   │       └── page.tsx         # Protected todo dashboard
│   ├── components/              # Reusable React components
│   │   ├── auth/
│   │   │   ├── SignupForm.tsx   # Signup form component
│   │   │   └── SigninForm.tsx   # Signin form component
│   │   └── tasks/
│   │       ├── TaskList.tsx     # Task list display
│   │       ├── TaskForm.tsx     # Add/edit task form
│   │       └── TaskItem.tsx     # Individual task component
│   ├── lib/                     # Utility libraries
│   │   ├── api.ts               # API client (fetch wrapper)
│   │   ├── auth.ts              # Better Auth configuration
│   │   └── types.ts             # TypeScript types
│   └── middleware.ts            # Next.js middleware (route protection)
├── package.json                 # Node dependencies
├── tsconfig.json                # TypeScript configuration
├── tailwind.config.ts           # Tailwind CSS configuration
├── next.config.js               # Next.js configuration
└── .env.local.example           # Environment template

.gitignore                       # Git ignore patterns
README.md                        # Project documentation
```

**Structure Decision**: Monorepo with separate `backend/` and `frontend/` directories. This structure:
- Enables independent development and deployment of frontend and backend
- Maintains clear separation of concerns per Constitution Principle XIII
- Allows different technology stacks (Python backend, TypeScript frontend)
- Facilitates scaling: backend can be deployed to one server, frontend to CDN/Vercel
- Follows industry standard for full-stack applications

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No Violations**: All constitution checks passed. No complexity tracking needed.

---

## Planning Artifacts Generated

This plan generated the following design documents in Phase 0 and Phase 1:

### Phase 0: Research & Decisions
- ✅ **research.md**: Technology stack decisions and implementation patterns
  - Next.js 16+ App Router with Better Auth
  - FastAPI with SQLModel ORM
  - Neon Serverless PostgreSQL
  - JWT authentication flow
  - Monorepo structure
  - Environment variable management
  - Password hashing with bcrypt
  - CORS configuration
  - Error handling strategy

### Phase 1: Design & Contracts
- ✅ **data-model.md**: Entity specifications
  - User entity (id, email, hashed_password, created_at)
  - Task entity (id, user_id, title, description, completed, created_at, updated_at)
  - 1:N relationship (User → Tasks)
  - Validation rules
  - User isolation enforcement

- ✅ **contracts/api-endpoints.md**: REST API specification
  - 7 endpoints total (3 auth, 4 tasks)
  - Request/response schemas
  - HTTP status codes
  - Error handling
  - Security considerations

- ✅ **quickstart.md**: Development and testing guide
  - Setup instructions (backend, frontend, database)
  - 7 manual test scenarios
  - Troubleshooting guide
  - Development tips

- ✅ **CLAUDE.md**: Agent context updated
  - Added Neon Serverless PostgreSQL to active technologies

---

## Next Steps

1. ✅ **Planning Complete**: All design artifacts generated
2. ⏭️ **Run `/sp.tasks`**: Generate implementation task list from this plan
3. ⏭️ **Run `/sp.implement`**: Execute tasks to build the application
4. ⏭️ **Manual Testing**: Follow quickstart.md test scenarios
5. ⏭️ **Deployment**: Deploy to production when validated

---

## Summary

**Feature**: Full-Stack Web Todo Application with Authentication
**Tech Stack**: Next.js 16+ (Frontend) + FastAPI (Backend) + Neon PostgreSQL (Database) + Better Auth (Authentication)
**Entities**: 2 (User, Task)
**Endpoints**: 7 (3 auth, 4 CRUD)
**User Stories**: 5 (prioritized P1-MVP → P3)
**Functional Requirements**: 54 (FR-001 to FR-054)
**Success Criteria**: 14 measurable outcomes
**Constitution Compliance**: ✅ All 13 principles satisfied
**Status**: Ready for task generation (`/sp.tasks`)
