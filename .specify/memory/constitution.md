# Hackathon II - Evolution of Todo: Phase II Constitution

<!--
SYNC IMPACT REPORT
==================
Version Change: 1.0.0 → 2.0.0
Rationale: MAJOR version bump - Fundamental architecture change from console-based Python application to full-stack web application with different technology stack, authentication, and persistent storage. This is a backward-incompatible governance change.

Modified Principles:
- "Phase I Scope Discipline" → "Phase II Scope Discipline" (expanded scope to include web, auth, database)
- "Feature Completeness Over Optimization" → Updated to maintain 5 core features but in web context
- "Deterministic and Predictable Behavior" → Expanded to include API contracts and HTTP responses
- "Explicit User Interaction Contracts" → Expanded to include REST API contracts and JWT authentication

Added Sections:
- Principle X: Authentication & Security First (new)
- Principle XI: Persistent Storage Mandate (new)
- Principle XII: User Isolation & Data Privacy (new)
- Principle XIII: Full-Stack Separation of Concerns (new)
- Phase II Tech Stack section
- Phase II Scope section (replacing Phase I scope)
- Updated Definition of Done for Phase II

Removed Sections:
- Phase I specific scope constraints (in-memory only, console only)

Templates Requiring Updates:
✅ .specify/templates/plan-template.md - Constitution check section aligns with new principles
✅ .specify/templates/spec-template.md - User scenario requirements align with web context
✅ .specify/templates/tasks-template.md - Task categorization supports full-stack development
✅ Command files in .claude/commands/ - Reviewed, no Phase-specific constraints embedded

Follow-up TODOs: None
-->

## Project Identity

This project is part of **Hackathon II – The Evolution of Todo, Phase II**.

The goal of this phase is to build a full-stack web application with authentication, persistent storage, and REST APIs using strict Spec-Driven Development with Claude Code and Spec-Kit Plus, without writing code manually.

**Technology**: Next.js 16+ (Frontend), FastAPI (Backend), Neon PostgreSQL (Database), Better Auth (Authentication)
**Methodology**: Spec-Driven Development (SDD)
**Tools**: Claude Code, Spec-Kit Plus
**Phase**: II (Full-Stack Web Application)

## Core Principles

### I. Spec-Driven First (NON-NEGOTIABLE)

All development MUST start from written specifications, never from code.

- No file may be implemented unless a corresponding spec exists and is approved
- Code is considered invalid if it is not traceable back to a written spec
- If implementation is incorrect, the spec MUST be refined, not the code manually edited
- Specs MUST be organized in the mandatory folder structure under `specs/`

**Rationale**: Ensures requirements drive implementation, prevents scope drift, and maintains alignment with project methodology.

### II. No Manual Coding (NON-NEGOTIABLE)

The human developer MUST NOT write application code directly.

- All frontend and backend implementation MUST be generated by Claude Code
- If output is incorrect, the spec MUST be refined and regenerated
- Manual code edits invalidate the development process
- Configuration files and infrastructure setup follow the same principle

**Rationale**: Enforces pure AI-assisted development workflow and demonstrates Spec-Driven Development methodology adherence.

### III. Phase II Scope Discipline

Phase II is strictly limited to:

- Full-stack web application (Next.js frontend + FastAPI backend)
- User authentication via Better Auth with JWT tokens
- Persistent storage in Neon Serverless PostgreSQL
- REST API with proper HTTP contracts
- Multi-user support with user isolation
- 5 core Todo operations accessible via web UI

Anything outside this scope MUST NOT be implemented. Specifically excluded:
- AI integration (reserved for Phase III)
- MCP server integration (reserved for Phase III)
- Advanced features (search, tags, priorities beyond complete/incomplete)
- Mobile apps
- Kubernetes deployment (reserved for Phase V)

**Rationale**: Maintains focus on web fundamentals, prevents premature complexity, establishes solid foundation for AI integration in Phase III.

### IV. Feature Completeness Over Optimization

All 5 Basic Todo features MUST be fully implemented in the web UI before any enhancement:

1. Add Task (via web form)
2. View Tasks (via web interface)
3. Update Task (via web form)
4. Delete Task (via web interface)
5. Mark Task as Complete / Incomplete (via web interface)

All features MUST work end-to-end: frontend → API → database → API → frontend.

No premature optimization or extra features are allowed until these are complete.

**Rationale**: Ensures MVP delivery, prevents over-engineering, validates core full-stack functionality first.

### V. Deterministic and Predictable Behavior

Web UI and API MUST be clear, consistent, and predictable.

User actions MUST always result in:
- Explicit confirmation messages in the UI
- Proper HTTP status codes (200, 201, 400, 401, 403, 404, 500)
- Clear error handling at all layers (frontend validation, API errors, database errors)
- Consistent formatting and interaction patterns
- Loading states during async operations

API responses MUST follow documented contracts in `specs/api/`.

**Rationale**: Provides reliable user experience, enables testing, simplifies debugging, ensures API contract compliance.

### VI. Clean Architecture Expectations

Code generated by Claude Code MUST follow:

**Frontend (Next.js)**:
- Server and Client Components properly separated
- React Server Components by default, Client Components when needed
- App Router conventions (not Pages Router)
- Clean component hierarchy and reusability

**Backend (FastAPI)**:
- Clear separation: routes → services → data access
- Proper dependency injection
- Middleware for cross-cutting concerns (auth, logging)
- Type hints with Pydantic models

**Database (SQLModel)**:
- Clean schema with proper relationships
- Migrations tracked and versioned
- No raw SQL unless absolutely necessary

**Rationale**: Even though code is AI-generated, it must be maintainable, understandable, and extensible by humans.

### VII. Explicit User Interaction Contracts

All user interactions MUST be documented in specs:

**Web UI** (`specs/ui/`):
- Page layouts and navigation
- Form inputs and validation rules
- Component behavior and states
- Error display patterns

**REST API** (`specs/api/`):
- Endpoints with HTTP methods
- Request/response schemas
- Status codes for success and error cases
- Authentication requirements

The API is treated as a formal contract between frontend and backend.

**Rationale**: Prevents ambiguity, enables validation, ensures consistent behavior, facilitates testing and integration.

### VIII. Testability by Design

Although automated tests are not required in Phase II:

- Logic MUST be deterministic and predictable
- Frontend components MUST be independently verifiable
- API endpoints MUST be testable via tools like curl or Postman
- Database operations MUST be traceable and verifiable
- Authentication flows MUST be manually testable

**Rationale**: Ensures quality, enables validation, prepares for automated testing in future phases.

### IX. Spec Evolution Is Expected

Specs are living documents.

Refinement is encouraged until:
- Behavior matches requirements
- Claude Code produces correct output without manual edits
- All acceptance criteria are met
- Full-stack integration works end-to-end

**Rationale**: Acknowledges iterative nature of specification development, allows for continuous improvement while maintaining spec-driven discipline.

### X. Authentication & Security First

User authentication and authorization are NON-NEGOTIABLE in Phase II.

- Better Auth MUST be integrated in the Next.js frontend
- JWT tokens MUST be issued upon successful login
- All API endpoints MUST verify JWT tokens (except public endpoints)
- Unauthenticated requests MUST return HTTP 401
- Unauthorized access attempts MUST return HTTP 403
- Passwords MUST be securely hashed (handled by Better Auth)
- No sensitive data in frontend code or URLs

**Rationale**: Establishes security foundation, enables multi-user support, prevents unauthorized access, protects user data.

### XI. Persistent Storage Mandate

All application data MUST persist in Neon Serverless PostgreSQL.

- In-memory storage is FORBIDDEN in Phase II
- Database schema MUST be documented in `specs/database/schema.md`
- All CRUD operations MUST read/write to the database
- Data MUST survive application restarts
- Database connection MUST use environment variables (never hardcoded)

**Rationale**: Provides data durability, enables multi-user scenarios, establishes production-ready data layer.

### XII. User Isolation & Data Privacy

Each user MUST only access their own data.

- Task ownership MUST be enforced at the database level (foreign key to user_id)
- API endpoints MUST validate user_id from JWT matches requested resources
- Cross-user data access MUST be prevented at all layers
- User enumeration attacks MUST be prevented (consistent error messages)
- User data MUST NOT leak in logs or error messages

**Rationale**: Protects user privacy, prevents data breaches, ensures regulatory compliance, builds user trust.

### XIII. Full-Stack Separation of Concerns

Frontend and backend MUST be clearly separated with defined boundaries.

**Frontend Responsibilities**:
- User interface rendering
- Client-side validation
- User interaction handling
- JWT token storage and inclusion in requests
- State management for UI

**Backend Responsibilities**:
- Business logic enforcement
- Server-side validation (never trust client)
- Database operations
- JWT verification and user authentication
- Data access control

**Communication**:
- ONLY via documented REST API endpoints
- Frontend MUST NOT directly access database
- Backend MUST NOT serve frontend UI (Next.js handles that)

**Rationale**: Enables independent development and testing, allows technology changes, enforces security boundaries, scales better.

## Phase II Tech Stack

### Required Technologies

**Frontend**:
- Framework: Next.js 16+ with App Router
- Language: TypeScript (preferred) or JavaScript
- Authentication: Better Auth
- Styling: Tailwind CSS or CSS Modules
- State Management: React hooks (useState, useContext) or Zustand if needed

**Backend**:
- Framework: FastAPI
- Language: Python 3.10+
- ORM: SQLModel
- Authentication: JWT verification (tokens issued by Better Auth)
- Validation: Pydantic models

**Database**:
- Provider: Neon Serverless PostgreSQL
- Access: SQLModel ORM
- Migrations: Alembic (if needed) or SQLModel's create_all

**Authentication**:
- Provider: Better Auth (runs in Next.js)
- Token Format: JWT
- Storage: HTTP-only cookies or localStorage (documented in spec)

### Technology Constraints

- No Python console UI (Phase I functionality is retired)
- No in-memory storage (replaced by PostgreSQL)
- No manual SQL (use ORM)
- No Pages Router (must use App Router)
- No class components (use functional components)

## Phase II Scope

### In Scope

**Core Features**:
- User signup and signin (Better Auth)
- JWT-based session management
- 5 core Todo operations via web UI
- REST API with full CRUD for tasks
- Multi-user support with data isolation
- Persistent storage in PostgreSQL

**Infrastructure**:
- Next.js frontend application
- FastAPI backend API
- Neon PostgreSQL database
- Better Auth integration
- Environment-based configuration

**User Experience**:
- Responsive web interface
- Form validation (client and server)
- Loading states
- Error messages
- Success confirmations

### Out of Scope

**Deferred to Phase III**:
- AI chatbot integration
- MCP server implementation
- Natural language task creation
- AI-powered suggestions

**Deferred to Later Phases**:
- Advanced task features (tags, priorities, categories, due dates)
- Search and filtering
- Task sharing or collaboration
- Mobile native apps
- Offline support
- Email notifications
- Third-party integrations
- Admin panel
- Analytics dashboard
- Kubernetes deployment

## Definition of Done

Phase II is considered complete ONLY if ALL conditions are met:

**Documentation**:
- ✅ Updated constitution for Phase II exists
- ✅ Specs exist in mandatory folder structure (`specs/overview.md`, `specs/architecture.md`, `specs/features/`, `specs/api/`, `specs/database/`, `specs/ui/`)
- ✅ All API endpoints documented in `specs/api/rest-endpoints.md`
- ✅ Database schema documented in `specs/database/schema.md`
- ✅ UI pages and components documented in `specs/ui/`

**Implementation**:
- ✅ Claude Code generated all frontend code (no manual coding)
- ✅ Claude Code generated all backend code (no manual coding)
- ✅ Next.js application runs successfully
- ✅ FastAPI application runs successfully
- ✅ Database schema deployed to Neon PostgreSQL

**Features**:
- ✅ User signup and signin work (Better Auth)
- ✅ JWT tokens are issued and verified
- ✅ All 5 Todo features accessible via web UI
- ✅ All 5 Todo features work end-to-end (UI → API → DB → API → UI)
- ✅ User isolation enforced (users only see their own tasks)

**Security**:
- ✅ Unauthenticated API requests return 401
- ✅ Cross-user access attempts return 403
- ✅ No sensitive data in frontend code
- ✅ Environment variables used for secrets

**Quality**:
- ✅ All acceptance criteria from specs validated
- ✅ Error handling works at all layers
- ✅ API contracts match implementation
- ✅ No manual code edits were performed

## Governance

### Constitutional Authority

The specification ALWAYS wins in case of conflict between:
- Human intent
- Claude Code output
- Existing code

**Resolution**: The spec MUST be updated and Claude Code MUST be rerun to regenerate implementation.

### Amendment Process

1. Identify conflict or needed change
2. Document proposed amendment and rationale
3. Update constitution with version increment
4. Regenerate affected artifacts
5. Validate consistency across all documents
6. Update SYNC IMPACT REPORT in constitution header

### Compliance Verification

- All generated code MUST be traceable to spec requirements
- All specs MUST align with constitutional principles
- All implementations MUST pass Definition of Done criteria
- Violations MUST be resolved by spec refinement, not manual code fixes
- Regular reviews MUST verify folder structure matches mandatory layout

### Version Control

Constitution follows semantic versioning:

- **MAJOR**: Backward incompatible governance/principle changes (e.g., Phase I → Phase II tech stack change)
- **MINOR**: New principle/section additions or material expansions
- **PATCH**: Clarifications, wording improvements, non-semantic refinements

## Forward Compatibility Note

This Phase II Constitution establishes the foundation for:

- **Phase III**: AI Chatbot Integration (OpenAI API + MCP)
- **Phase IV**: Cloud-Native Architecture
- **Phase V**: Kubernetes Deployment

All future phases MUST extend, not violate, these principles.

The core principles of Spec-Driven Development, No Manual Coding, and Clean Architecture will persist across all phases.

Phase II's authentication and database infrastructure will be reused in all future phases.

---

**Version**: 2.0.0 | **Ratified**: 2025-12-19 | **Last Amended**: 2025-12-21
